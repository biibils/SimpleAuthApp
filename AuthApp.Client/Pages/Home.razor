@page "/"
@inject HttpClient Http
@inject NavigationManager NavManager
@using AuthApp.Application.DTOs

<div style="max-width: 500px; margin: 30px auto; padding: 25px; border: 1px solid #ddd; border-radius: 10px; font-family: sans-serif;">
    <h3 style="text-align: center;">Daftar Akun Baru</h3>
    <hr />

    <div style="margin-bottom: 15px;">
        <label style="display: block; font-weight: bold;">Nama Lengkap:</label>
        <input type="text" @bind="model.FullName" style="width: 100%; padding: 8px; border: 1px solid #ccc;" />
    </div>

    <div style="margin-bottom: 15px;">
        <label style="display: block; font-weight: bold;">Email:</label>
        <input type="email" @bind="model.Email" style="width: 100%; padding: 8px; border: 1px solid #ccc;" />
    </div>

    <div style="margin-bottom: 15px;">
        <label style="display: block; font-weight: bold;">Password:</label>
        <input type="password" @bind="model.Password" style="width: 100%; padding: 8px; border: 1px solid #ccc;" />
    </div>

    <div style="margin-bottom: 15px;">
        <label style="display: block; font-weight: bold;">Tanggal Lahir:</label>
        <input type="date" @bind="model.BirthDate" style="width: 100%; padding: 8px; border: 1px solid #ccc;" />
    </div>

    <div style="margin-bottom: 15px;">
        <label style="display: block; font-weight: bold;">Jenis Kelamin:</label>
        <select @bind="model.Gender" style="width: 100%; padding: 8px; border: 1px solid #ccc;">
            <option value="L">Laki-laki</option>
            <option value="P">Perempuan</option>
        </select>
    </div>

    @if (!string.IsNullOrEmpty(statusMessage))
    {
        <div style="padding: 10px; margin-bottom: 15px; border-radius: 5px; background-color: @(isError ? "#ffdce0" : "#d4edda"); color: @(isError ? "#af0606" : "#155724");">
            @statusMessage
        </div>
    }

    <button @onclick="HandleRegister" disabled="@isSubmitting" style="width: 100%; padding: 12px; background-color: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;">
        @(isSubmitting ? "Memproses..." : "Daftar Sekarang")
    </button>

    <p style="text-align: center; margin-top: 15px;">
        Sudah punya akun? <a href="/login" style="color: #007bff; text-decoration: none;">Login di sini</a>
    </p>
</div>

@code {
    private RegisterRequest model = new RegisterRequest();
    private bool isSubmitting = false;
    private string statusMessage = "";
    private bool isError = false;

    private async Task HandleRegister()
    {
        isSubmitting = true;
        statusMessage = "";
        isError = false;

        try
        {
            var response = await Http.PostAsJsonAsync("api/Auth/register", model);

            if (response.IsSuccessStatusCode)
            {
                statusMessage = "Registrasi Berhasil! Mengalihkan ke halaman login...";
                StateHasChanged(); // Update tampilan
                await Task.Delay(2000); // Tunggu sebentar biar user baca suksesnya
                NavManager.NavigateTo("/login");
            }
            else
            {
                isError = true;
                // Ambil detail error dari API (biasanya dari FluentValidation)
                var errorBody = await response.Content.ReadAsStringAsync();
                statusMessage = $"Gagal: {errorBody}";
            }
        }
        catch (Exception ex)
        {
            isError = true;
            statusMessage = "Error koneksi ke API: " + ex.Message;
            Console.WriteLine(ex.ToString());
        }
        finally
        {
            isSubmitting = false;
        }
    }
}